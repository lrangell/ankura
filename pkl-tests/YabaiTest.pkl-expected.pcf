import "../pkl/yabai.pkl" as y
import "../pkl/karabiner.pkl" as k
import "../pkl/keys.pkl"

facts {
  ["Yabai module should create default empty config"] {
    true
  }
  ["Yabai window focus should accept modifier and directions"] {
    true
    true
    true
  }
  ["Yabai space focus should accept modifier and mappings"] {
    true
    true
  }
  ["Yabai toggles should accept modifier and toggle keys"] {
    true
    true
  }
  ["Yabai build should return List of Rules"] {
    true
  }
}
examples {
  ["Yabai window focus configuration"] {
    List(new k.Rule {
      description = "Yabai: Focus windows"
      manipulators = List(
        new k.Manipulator {
          type = "basic"
          from {
            key_code = "h"
            consumer_key_code = null
            pointing_button = null
            modifiers {
              mandatory = List("left_command")
              optional = null
            }
            simultaneous = null
            simultaneous_options = null
          }
          to = List(new k.ToEvent {
            key_code = null
            consumer_key_code = null
            pointing_button = null
            shell_command = "/opt/homebrew/bin/yabai -m window --focus west"
            select_input_source = null
            set_variable = null
            mouse_key = null
            sticky_modifier = null
            modifiers = null
            lazy = null
            repeat = null
            halt = null
            hold_down_milliseconds = null
          })
          to_if_alone = null
          to_after_key_up = null
          to_delayed_action = null
          conditions = null
          parameters = null
        },
        new k.Manipulator {
          type = "basic"
          from {
            key_code = "j"
            consumer_key_code = null
            pointing_button = null
            modifiers {
              mandatory = List("left_command")
              optional = null
            }
            simultaneous = null
            simultaneous_options = null
          }
          to = List(new k.ToEvent {
            key_code = null
            consumer_key_code = null
            pointing_button = null
            shell_command = "/opt/homebrew/bin/yabai -m window --focus south"
            select_input_source = null
            set_variable = null
            mouse_key = null
            sticky_modifier = null
            modifiers = null
            lazy = null
            repeat = null
            halt = null
            hold_down_milliseconds = null
          })
          to_if_alone = null
          to_after_key_up = null
          to_delayed_action = null
          conditions = null
          parameters = null
        },
        new k.Manipulator {
          type = "basic"
          from {
            key_code = "k"
            consumer_key_code = null
            pointing_button = null
            modifiers {
              mandatory = List("left_command")
              optional = null
            }
            simultaneous = null
            simultaneous_options = null
          }
          to = List(new k.ToEvent {
            key_code = null
            consumer_key_code = null
            pointing_button = null
            shell_command = "/opt/homebrew/bin/yabai -m window --focus north"
            select_input_source = null
            set_variable = null
            mouse_key = null
            sticky_modifier = null
            modifiers = null
            lazy = null
            repeat = null
            halt = null
            hold_down_milliseconds = null
          })
          to_if_alone = null
          to_after_key_up = null
          to_delayed_action = null
          conditions = null
          parameters = null
        },
        new k.Manipulator {
          type = "basic"
          from {
            key_code = "l"
            consumer_key_code = null
            pointing_button = null
            modifiers {
              mandatory = List("left_command")
              optional = null
            }
            simultaneous = null
            simultaneous_options = null
          }
          to = List(new k.ToEvent {
            key_code = null
            consumer_key_code = null
            pointing_button = null
            shell_command = "/opt/homebrew/bin/yabai -m window --focus east"
            select_input_source = null
            set_variable = null
            mouse_key = null
            sticky_modifier = null
            modifiers = null
            lazy = null
            repeat = null
            halt = null
            hold_down_milliseconds = null
          })
          to_if_alone = null
          to_after_key_up = null
          to_delayed_action = null
          conditions = null
          parameters = null
        }
      )
    })
  }
  ["Complete config with Yabai integration"] {
    new k.Config {
      title = "Karabiner-Pkl Configuration"
      profiles = List(new k.Profile {
        name = "yabai-test"
        selected = true
        virtual_hid_keyboard = null
        devices = List()
        fn_function_keys = List()
        simple_modifications = List()
        complex_modifications {
          parameters = null
          rules = List(new k.Rule {
            description = "Yabai: Focus windows"
            manipulators = List(
              new k.Manipulator {
                type = "basic"
                from {
                  key_code = "h"
                  consumer_key_code = null
                  pointing_button = null
                  modifiers {
                    mandatory = List("left_command")
                    optional = null
                  }
                  simultaneous = null
                  simultaneous_options = null
                }
                to = List(new k.ToEvent {
                  key_code = null
                  consumer_key_code = null
                  pointing_button = null
                  shell_command = "/opt/homebrew/bin/yabai -m window --focus west"
                  select_input_source = null
                  set_variable = null
                  mouse_key = null
                  sticky_modifier = null
                  modifiers = null
                  lazy = null
                  repeat = null
                  halt = null
                  hold_down_milliseconds = null
                })
                to_if_alone = null
                to_after_key_up = null
                to_delayed_action = null
                conditions = null
                parameters = null
              },
              new k.Manipulator {
                type = "basic"
                from {
                  key_code = "j"
                  consumer_key_code = null
                  pointing_button = null
                  modifiers {
                    mandatory = List("left_command")
                    optional = null
                  }
                  simultaneous = null
                  simultaneous_options = null
                }
                to = List(new k.ToEvent {
                  key_code = null
                  consumer_key_code = null
                  pointing_button = null
                  shell_command = "/opt/homebrew/bin/yabai -m window --focus south"
                  select_input_source = null
                  set_variable = null
                  mouse_key = null
                  sticky_modifier = null
                  modifiers = null
                  lazy = null
                  repeat = null
                  halt = null
                  hold_down_milliseconds = null
                })
                to_if_alone = null
                to_after_key_up = null
                to_delayed_action = null
                conditions = null
                parameters = null
              },
              new k.Manipulator {
                type = "basic"
                from {
                  key_code = "k"
                  consumer_key_code = null
                  pointing_button = null
                  modifiers {
                    mandatory = List("left_command")
                    optional = null
                  }
                  simultaneous = null
                  simultaneous_options = null
                }
                to = List(new k.ToEvent {
                  key_code = null
                  consumer_key_code = null
                  pointing_button = null
                  shell_command = "/opt/homebrew/bin/yabai -m window --focus north"
                  select_input_source = null
                  set_variable = null
                  mouse_key = null
                  sticky_modifier = null
                  modifiers = null
                  lazy = null
                  repeat = null
                  halt = null
                  hold_down_milliseconds = null
                })
                to_if_alone = null
                to_after_key_up = null
                to_delayed_action = null
                conditions = null
                parameters = null
              },
              new k.Manipulator {
                type = "basic"
                from {
                  key_code = "l"
                  consumer_key_code = null
                  pointing_button = null
                  modifiers {
                    mandatory = List("left_command")
                    optional = null
                  }
                  simultaneous = null
                  simultaneous_options = null
                }
                to = List(new k.ToEvent {
                  key_code = null
                  consumer_key_code = null
                  pointing_button = null
                  shell_command = "/opt/homebrew/bin/yabai -m window --focus east"
                  select_input_source = null
                  set_variable = null
                  mouse_key = null
                  sticky_modifier = null
                  modifiers = null
                  lazy = null
                  repeat = null
                  halt = null
                  hold_down_milliseconds = null
                })
                to_if_alone = null
                to_after_key_up = null
                to_delayed_action = null
                conditions = null
                parameters = null
              }
            )
          })
        }
        parameters = null
      })
      global = null
    }
  }
}