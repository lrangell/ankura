module yabai_enhanced_test

import "modulepath:/karabiner.pkl" as karabiner
import "modulepath:/yabai.pkl" as yabai
local minimalYabai = new yabai.Yabai {
  focusWindow = new yabai.WindowNav {
    modifiers = List("command", "option")
  }
}

local completeYabai = new yabai.Yabai {
  focusWindow = new yabai.WindowNav {
    modifiers = List("option")
    left = "h"
    down = "j"
    up = "k"
    right = "l"
    recent = "tab"
  }
  
  swapWindow = new yabai.WindowNav {
    modifiers = List("option", "shift")
    left = "h"
    down = "j"
    up = "k"
    right = "l"
  }
  
  warpWindow = new yabai.WindowNav {
    modifiers = List("option", "command")
    left = "h"
    down = "j"
    up = "k"
    right = "l"
  }
  
  focusSpace = new yabai.SpaceNav {
    modifiers = List("command")
    spaces = List("1", "2", "3", "4", "5")
    prev = "bracketleft"
    next = "bracketright"
    recent = "grave_accent_and_tilde"
  }
  
  moveToSpace = new yabai.SpaceNav {
    modifiers = List("command", "shift")
    spaces = List("1", "2", "3", "4", "5")
    prev = "comma"
    next = "period"
  }
  
  focusDisplay = new yabai.DisplayNav {
    modifiers = List("command", "option")
    displays = List("1", "2")
    prev = "left_arrow"
    next = "right_arrow"
  }
  
  moveToDisplay = new yabai.DisplayNav {
    modifiers = List("command", "option", "shift")
    displays = List("1", "2")
  }
  
  toggles = new yabai.Toggles {
    modifiers = List("command", "option", "shift")
    float = "f"
    sticky = "s"
    fullscreen = "m"
    split = "e"
    minimize = "n"
    gap = "g"
    padding = "p"
  }
  
  layout = new yabai.Layout {
    modifiers = List("command", "option", "control")
    bsp = "b"
    float = "f"
    balance = "equal_sign"
    rotate = "r"
    mirrorX = "x"
    mirrorY = "y"
  }
  
  resize = new yabai.Resize {
    modifiers = List("control", "option")
    increase = "plus"
    decrease = "minus"
    equalize = "0"
    left = "h"
    down = "j"
    up = "k"
    right = "l"
    amount = 100
  }
  
  ratio = new yabai.Ratio {
    modifiers = List("control", "option", "shift")
    increase = "plus"
    decrease = "minus"
    reset = "0"
    amount = 0.05
  }
  
  insert = new yabai.Insert {
    modifiers = List("control", "command")
    left = "h"
    down = "j"
    up = "k"
    right = "l"
    stack = "s"
    cancel = "escape"
  }
  
  moveFloat = new yabai.MoveFloat {
    modifiers = List("control", "shift")
    left = "left_arrow"
    down = "down_arrow"
    up = "up_arrow"
    right = "right_arrow"
    center = "c"
    amount = 25
  }
  
  grid = new yabai.Grid {
    modifiers = List("control", "command", "option")
    leftHalf = "left_arrow"
    rightHalf = "right_arrow"
    topHalf = "up_arrow"
    bottomHalf = "down_arrow"
    fullscreen = "f"
    center = "c"
    topLeft = "u"
    topRight = "i"
    bottomLeft = "j"
    bottomRight = "k"
  }
}

local hyperYabai = new yabai.Yabai {
  local hyperKey = List("command", "option", "control", "shift")
  
  focusWindow = new yabai.WindowNav {
    modifiers = hyperKey
  }
  
  swapWindow = new yabai.WindowNav {
    modifiers = hyperKey
    left = "h"
    down = "j"
    up = "k"
    right = "l"
  }
  
  toggles = new yabai.Toggles {
    modifiers = hyperKey
    float = "f"
    fullscreen = "m"
  }
}

local arrowYabai = new yabai.Yabai {
  focusWindow = new yabai.WindowNav {
    modifiers = List("command")
    left = "left_arrow"
    down = "down_arrow"
    up = "up_arrow"
    right = "right_arrow"
  }
  
  swapWindow = new yabai.WindowNav {
    modifiers = List("command", "shift")
    left = "left_arrow"
    down = "down_arrow"
    up = "up_arrow"
    right = "right_arrow"
  }
}

config: karabiner.Config = new {
  profiles = List(
    new karabiner.Profile {
      name = "pkl"
      complex_modifications = new karabiner.ComplexModifications {
        rules = minimalYabai.generateRules() + 
                completeYabai.generateRules() + 
                hyperYabai.generateRules() + 
                arrowYabai.generateRules()
      }
    }
  )
}